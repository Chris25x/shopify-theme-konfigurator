<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1200, initial-scale=0.5, maximum-scale=3, user-scalable=yes">
  <meta name="description" content="Sicherungskasten fertig verdrahtet online konfigurieren. Vormontierte Verteilerkästen mit Hager &amp; Gewiss. Preis sofort berechnen ✓ Lieferzeit 2-5 Tage ✓ Professionell verdrahtet ✓">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
  <title>Sicherungskasten fertig verdrahtet - Online Konfigurator | Sicherungskasten24</title>
  <!-- Font Awesome für Icons - Lazy Loading für bessere Performance -->
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"></noscript>
  <!-- jsPDF wird lazy geladen, wenn der PDF-Button geklickt wird -->
  <!-- Inter Schriftart (Theme Standard) -->
  <!-- Konfigurator CSS -->
  <link href="{{ 'page-konfigurator.css' | asset_url }}" rel="stylesheet">
  {{ 'quantity-popover.css' | asset_url | stylesheet_tag }}
</head>
<body class="konfigurator-page">
  

  {%- style -%}
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top | default: 40 }}px;
      padding-bottom: {{ section.settings.padding_bottom | default: 40 }}px;
    }
    @media (min-width: 750px) {
      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top_desktop | default: section.settings.padding_top | default: 40 }}px;
        padding-bottom: {{ section.settings.padding_bottom_desktop | default: section.settings.padding_bottom | default: 40 }}px;
      }
    }
    
    /* Mobile Scroll-Fix: Verhindert Section-internes Scrollen - PRÄZISE */
    @media (max-width: 1024px) {
      /* Body-Scroll komplett normalisieren */
      body.konfigurator-page {
        overflow-x: visible !important;
        overflow-y: visible !important;
        position: static !important;
        height: auto !important;
        width: 100% !important;
      }
      
      /* HTML-Element normalisieren */
      html.konfigurator-page {
        overflow-x: visible !important;
        overflow-y: visible !important;
        height: auto !important;
        width: 100% !important;
      }
      
      /* Nur spezifische Scroll-Container normalisieren - FAQ-Section schützen */
      .konfigurator-page .page-container,
      .konfigurator-page .main-content,
      .konfigurator-page .page-content,
      .konfigurator-page .konfigurator-container,
      .konfigurator-page .konfigurator-content,
      .konfigurator-page .container {
        overflow-x: visible !important;
        overflow-y: visible !important;
      }
      
      /* FAQ-Section schützen - normale Overflow-Eigenschaften beibehalten */
      .konfigurator-page .faq-section,
      .konfigurator-page .faq-item,
      .konfigurator-page .faq-content,
      .konfigurator-page .collapsible-content {
        overflow-x: visible !important;
        overflow-y: visible !important;
      }
      
      /* Fixed/Sticky Elemente auf Mobile deaktivieren */
      .konfigurator-page .fixed:not(.button-row):not(.button-container),
      .konfigurator-page .sticky:not(.button-row):not(.button-container) {
        position: static !important;
        top: auto !important;
        left: auto !important;
        right: auto !important;
        bottom: auto !important;
      }
      
      /* Button-Row und Button-Container auf Mobile normalisieren */
      .konfigurator-page .button-row,
      .konfigurator-page .button-container {
        background: none !important;
        box-shadow: none !important;
        position: static !important;
      }
      
      /* Konfigurator-Disclaimer auf Mobile */
      .konfigurator-page .konfigurator-disclaimer {
        background: #ffffff !important;
      }
      
      /* Touch-Scroll für normale Seiten-Scroll optimieren */
      .konfigurator-page {
        -webkit-overflow-scrolling: touch !important;
        overscroll-behavior: auto !important;
      }
    }
    
    /* Konfigurator-Disclaimer weißen Hintergrund auf Desktop */
    .konfigurator-page .konfigurator-disclaimer {
      background: #ffffff !important;
    }
    
    /* Konfigurator-Button auf Mobile kleiner machen für /pages/konfigurator */
    @media (max-width: 1024px) {
      body.konfigurator-page .header__icon--konfigurator,
      body.konfigurator-page .header a[href*="konfigurator"].button,
      body.konfigurator-page .header a[href*="konfigurator"].button--primary {
        display: inline-flex !important;
        visibility: visible !important;
        opacity: 1 !important;
        height: auto !important;
        width: auto !important;
        overflow: visible !important;
        position: static !important;
        left: auto !important;
        top: auto !important;
        /* Mobile-optimierte Größe */
        padding: 8px 12px !important;
        font-size: 12px !important;
        min-width: 120px !important;
        margin: 0 4px 0 0 !important;
      }
    }
    
    /* Zusätzliche Sicherheit: Button kleiner machen basierend auf URL */
    @media (max-width: 1024px) {
      .header__icon--konfigurator[href*="konfigurator"] {
        display: inline-flex !important;
        visibility: visible !important;
        opacity: 1 !important;
        height: auto !important;
        width: auto !important;
        overflow: visible !important;
        position: static !important;
        left: auto !important;
        top: auto !important;
        /* Mobile-optimierte Größe */
        padding: 8px 12px !important;
        font-size: 12px !important;
        min-width: 120px !important;
        margin: 0 4px 0 0 !important;
      }
      
      /* Navigation auf Touch-Geräten zentriert zwischen Logo und Icons */
      body.konfigurator-page.touch-device .header,
      body.konfigurator-page.is-mobile .header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        position: relative !important;
        flex-wrap: nowrap !important;
      }

      body.konfigurator-page.touch-device .header__heading,
      body.konfigurator-page.is-mobile .header__heading {
        flex: 0 0 auto !important;
        order: 1 !important;
        margin-right: 0 !important;
      }

      body.konfigurator-page.touch-device .header__inline-menu,
      body.konfigurator-page.is-mobile .header__inline-menu {
        position: absolute !important;
        left: calc(50% + 20px) !important;
        transform: translateX(-50%) !important;
        display: flex !important;
        flex: 0 0 auto !important;
        z-index: 1 !important;
        margin: 0 !important;
        visibility: visible !important;
        opacity: 1 !important;
        order: 2 !important;
        width: auto !important;
      }

      body.konfigurator-page.touch-device .header__icons,
      body.konfigurator-page.is-mobile .header__icons {
        flex: 0 0 auto !important;
        margin-left: auto !important;
        order: 3 !important;
      }

      body.konfigurator-page.touch-device .header__inline-menu .list-menu--inline,
      body.konfigurator-page.is-mobile .header__inline-menu .list-menu--inline {
        justify-content: center !important;
        align-items: center !important;
        gap: 0.8rem !important;
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        white-space: nowrap !important;
      }

      body.konfigurator-page.touch-device .header__inline-menu .list-menu__item,
      body.konfigurator-page.is-mobile .header__inline-menu .list-menu__item {
        display: inline-block !important;
        white-space: nowrap !important;
        flex-shrink: 0 !important;
      }
    }
    
  {%- endstyle -%}
  
  {%- assign default_marke = section.settings.default_marke | default: 'Hager' -%}
  <script>
    // Standard-Marke aus Section-Settings
    const DEFAULT_MARKE = '{{ default_marke }}';
    const DEFAULT_MARKE_LOGO_URL = {% if default_marke == 'Gewiss' %}'https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Gewiss.png?v=1769095061'{% elsif default_marke == 'Eaton' %}'https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Eaton.png?v=1769090184'{% else %}'https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Hager-Logo.png?v=1769094527'{% endif %};
    
    // Zusätzliche JavaScript-Sicherheit für Konfigurator-Seite
    document.addEventListener('DOMContentLoaded', function() {
      if (window.location.pathname.includes('/pages/konfigurator')) {
        document.body.classList.add('konfigurator-page');
        
        // Erkenne Touch-Geräte für Button-Ausblendung (auch wenn als Desktop erkannt)
        const isTouchDevice = ('ontouchstart' in window) || 
                              (navigator.maxTouchPoints > 0) || 
                              (navigator.msMaxTouchPoints > 0) ||
                              /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        if (isTouchDevice) {
          document.body.classList.add('touch-device', 'is-mobile');
          
          // Verstecke den Konfigurator-Button im Header
          const konfigButton = document.querySelector('.header__icon--konfigurator');
          if (konfigButton) {
            konfigButton.style.display = 'none';
            konfigButton.style.visibility = 'hidden';
            konfigButton.style.opacity = '0';
            konfigButton.style.height = '0';
            konfigButton.style.width = '0';
            konfigButton.style.overflow = 'hidden';
            konfigButton.style.position = 'absolute';
            konfigButton.style.left = '-9999px';
            konfigButton.style.top = '-9999px';
            konfigButton.style.margin = '0';
            konfigButton.style.padding = '0';
          }
        }
        
        // Mobile Scroll-Fix: Verhindert Section-internes Scrollen - PRÄZISE
        function fixMobileScroll() {
          if (window.innerWidth <= 1024) {
            // HTML und Body komplett normalisieren
            document.documentElement.style.overflow = 'visible';
            document.body.style.overflow = 'visible';
            document.body.style.position = 'static';
            document.body.style.height = 'auto';
            document.body.style.width = '100%';
            
            // Nur spezifische Scroll-Container normalisieren - FAQ-Section schützen
            const scrollContainers = document.querySelectorAll('.page-container, .main-content, .page-content, .konfigurator-container, .konfigurator-content, .container');
            scrollContainers.forEach(container => {
              container.style.overflowX = 'visible';
              container.style.overflowY = 'visible';
            });
            
            // FAQ-Section schützen - normale Overflow-Eigenschaften beibehalten
            const faqElements = document.querySelectorAll('.faq-section, .faq-item, .faq-content, .collapsible-content');
            faqElements.forEach(element => {
              element.style.overflowX = 'visible';
              element.style.overflowY = 'visible';
            });
            
            // Fixed/Sticky Elemente normalisieren - aber Button-Container ausnehmen
            const fixedElements = document.querySelectorAll('.fixed:not(.button-row):not(.button-container), .sticky:not(.button-row):not(.button-container)');
            fixedElements.forEach(element => {
              element.style.position = 'static';
              element.style.top = 'auto';
              element.style.left = 'auto';
              element.style.right = 'auto';
              element.style.bottom = 'auto';
            });
            
            // Button-Row und Button-Container auf Mobile normalisieren
            const buttonRows = document.querySelectorAll('.button-row, .button-container');
            buttonRows.forEach(buttonRow => {
              buttonRow.style.background = 'none';
              buttonRow.style.boxShadow = 'none';
              buttonRow.style.position = 'static';
            });
            
            // Konfigurator-Disclaimer weißen Hintergrund geben
            const disclaimerElements = document.querySelectorAll('.konfigurator-disclaimer');
            disclaimerElements.forEach(disclaimer => {
              disclaimer.style.background = '#ffffff';
            });
          }
        }
        
        // Bei Seitenlade und Resize
        fixMobileScroll();
        window.addEventListener('resize', fixMobileScroll);
        
        // Button auf Mobile kleiner machen statt ausblenden
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const konfigButton = document.querySelector('.header__icon--konfigurator');
        
        if (konfigButton && isMobile) {
          konfigButton.style.display = 'inline-flex';
          konfigButton.style.visibility = 'visible';
          konfigButton.style.opacity = '1';
          konfigButton.style.height = 'auto';
          konfigButton.style.width = 'auto';
          konfigButton.style.overflow = 'visible';
          konfigButton.style.position = 'static';
          konfigButton.style.left = 'auto';
          konfigButton.style.top = 'auto';
          // Mobile-optimierte Größe
          konfigButton.style.padding = '8px 12px';
          konfigButton.style.fontSize = '12px';
          konfigButton.style.minWidth = '120px';
          konfigButton.style.margin = '0 4px 0 0';
        }
        
        
        // Bei Größenänderung reagieren (nur wenn es wirklich ein Gerätewechsel ist)
        let lastDeviceType = isMobile ? 'mobile' : 'desktop';
        window.addEventListener('resize', function() {
          const currentIsMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
          const currentDeviceType = currentIsMobile ? 'mobile' : 'desktop';
          const konfigButton = document.querySelector('.header__icon--konfigurator');
          
          // Nur reagieren wenn sich der Gerätetyp wirklich geändert hat
          if (currentDeviceType !== lastDeviceType && konfigButton) {
            lastDeviceType = currentDeviceType;
            
            if (currentIsMobile) {
              // Mobile: Button kleiner machen
              konfigButton.style.display = 'inline-flex';
              konfigButton.style.visibility = 'visible';
              konfigButton.style.opacity = '1';
              konfigButton.style.height = 'auto';
              konfigButton.style.width = 'auto';
              konfigButton.style.overflow = 'visible';
              konfigButton.style.position = 'static';
              konfigButton.style.left = 'auto';
              konfigButton.style.top = 'auto';
              konfigButton.style.padding = '8px 12px';
              konfigButton.style.fontSize = '12px';
              konfigButton.style.minWidth = '120px';
              konfigButton.style.margin = '0 4px 0 0';
            } else {
              // Desktop: Button normale Größe
              konfigButton.style.display = '';
              konfigButton.style.visibility = '';
              konfigButton.style.opacity = '';
              konfigButton.style.height = '';
              konfigButton.style.width = '';
              konfigButton.style.overflow = '';
              konfigButton.style.position = '';
              konfigButton.style.left = '';
              konfigButton.style.top = '';
              konfigButton.style.margin = '';
              konfigButton.style.padding = '';
              konfigButton.style.fontSize = '';
              konfigButton.style.minWidth = '';
            }
          }
        });
      }
    });
    
  </script>
  <div class="section-{{ section.id }}-padding">
  <main class="container konfigurator" role="main" aria-label="Sicherungskasten Konfigurator">
    <div class="konfigurator-top-gap"></div>
    <h1 class="konfigurator-page-title">Sicherungskasten Konfigurator</h1>
    <h2 class="konfigurator-page-subtitle">Konfigurieren Sie Ihren Sicherungskasten Schritt für Schritt. Preis sofort berechnen, professionelle Verdrahtung, schnelle Lieferung.</h2>
    <!-- Statusleiste -->
    <div class="statusbar" aria-label="Fortschritt Konfigurator">
      <div class="step step--active" id="step1" data-icon="fas fa-cog">
        <div class="step__icon"><i class="fas fa-cog" aria-hidden="true"></i></div>
        <div class="step__text">
          <div class="step__label">Konfiguration</div>
          <div class="step__sub">Aktueller Schritt</div>
        </div>
      </div>
      <div class="statusbar__connector" aria-hidden="true"></div>
      <div class="step step--todo" id="step2" data-icon="fas fa-box">
        <div class="step__icon"><i class="fas fa-box" aria-hidden="true"></i></div>
        <div class="step__text">
          <div class="step__label">Verteilerkasten</div>
          <div class="step__sub">Ausstehend</div>
        </div>
      </div>
      <div class="statusbar__connector" aria-hidden="true"></div>
      <div class="step step--todo" id="step3" data-icon="fas fa-wrench">
        <div class="step__icon"><i class="fas fa-wrench" aria-hidden="true"></i></div>
        <div class="step__text">
          <div class="step__label">Verdrahtung</div>
          <div class="step__sub">Ausstehend</div>
        </div>
      </div>
      <div class="statusbar__connector" aria-hidden="true"></div>
      <div class="step step--todo" id="step4" data-icon="fas fa-file-alt">
        <div class="step__icon"><i class="fas fa-file-alt" aria-hidden="true"></i></div>
        <div class="step__text">
          <div class="step__label">Zusammenfassung</div>
          <div class="step__sub">Ausstehend</div>
        </div>
      </div>
    </div>

    <!-- Neuer Container für Seiten und Button -->
    <div id="page1" class="page active">
      <!-- Hinweise zur Verteilung -->
      <div class="konfigurator-disclaimer">
        <button type="button" class="konfigurator-disclaimer__header" id="disclaimer-toggle" aria-expanded="true" aria-controls="disclaimer-cards">
          <i class="fas fa-clipboard-check"></i>
          <div>
            <h3 class="konfigurator-disclaimer__title">Hinweise zur Verteilung</h3>
            <p class="konfigurator-disclaimer__subtitle">Die wichtigsten Informationen im Überblick.</p>
          </div>
          <i class="fas fa-chevron-down konfigurator-disclaimer__toggle-icon" aria-hidden="true"></i>
        </button>
        <div class="konfigurator-disclaimer__cards" id="disclaimer-cards">
          <div class="konfigurator-disclaimer__card">
            <i class="fas fa-bolt konfigurator-disclaimer__icon" aria-hidden="true"></i>
            <div class="konfigurator-disclaimer__card-content">
              <div class="konfigurator-disclaimer__card-title">Hauptanschlussklemme</div>
              <p class="konfigurator-disclaimer__card-text">Serienmäßig enthalten – ermöglicht den Direktanschluss der Hauptzuleitung ohne Mehraufwand.</p>
            </div>
          </div>
          <div class="konfigurator-disclaimer__card">
            <i class="fas fa-tools konfigurator-disclaimer__icon" aria-hidden="true"></i>
            <div class="konfigurator-disclaimer__card-content">
              <div class="konfigurator-disclaimer__card-title">Verdrahtung</div>
              <p class="konfigurator-disclaimer__card-text">Standardmäßig mit 10&nbsp;mm² Kupferleitung nach Herstellervorgaben ausgeführt.</p>
            </div>
          </div>
          <div class="konfigurator-disclaimer__card">
            <i class="fas fa-industry konfigurator-disclaimer__icon" aria-hidden="true"></i>
            <div class="konfigurator-disclaimer__card-content">
              <div class="konfigurator-disclaimer__card-title">Markenqualität</div>
              <p class="konfigurator-disclaimer__card-text">Hauptkomponenten von HAGER, GEWISS oder EATON, Spezialteile z. B. von Eltako.</p>
            </div>
          </div>
          <div class="konfigurator-disclaimer__card">
            <i class="fas fa-headset konfigurator-disclaimer__icon" aria-hidden="true"></i>
            <div class="konfigurator-disclaimer__card-content">
              <div class="konfigurator-disclaimer__card-title">Sonderwünsche</div>
              <p class="konfigurator-disclaimer__card-text">Besondere Wünsche? Hinterlasse sie im Feld „Sonstige Hinweise“ oder <a href="/#contact" class="konfigurator-disclaimer__link">kontaktiere</a> uns direkt.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Marken-Info -->
      <div class="konfigurator-brand-info">
        <span class="brand-label">Marke der Komponenten wählen (Fi/Sicherungsmaterial):</span>
        {%- assign default_marke = section.settings.default_marke | default: 'Gewiss' -%}
        <div class="brand-selector-container">
          <div class="brand-radio-group" role="radiogroup" aria-label="Marke der Komponenten">
            <label class="brand-radio-option{% if default_marke == 'Hager' %} is-selected{% endif %}">
              <input type="radio"
                     name="brandSelection"
                     value="Hager"
                     aria-label="Hager"
                     data-logo-url="https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Hager-Logo.png?v=1769094527"
                     {% if default_marke == 'Hager' %}checked{% endif %}>
              <img src="https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Hager-Logo.png?v=1769094527" alt="Hager Logo" class="brand-radio-image" loading="lazy">
            </label>
            <label class="brand-radio-option{% if default_marke != 'Hager' %} is-selected{% endif %}">
              <input type="radio"
                     name="brandSelection"
                     value="Gewiss"
                     aria-label="Gewiss"
                     data-logo-url="https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Gewiss.png?v=1769095061"
                     {% if default_marke != 'Hager' %}checked{% endif %}>
              <img src="https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Gewiss.png?v=1769095061" alt="Gewiss Logo" class="brand-radio-image" loading="lazy">
            </label>
            <label class="brand-radio-option">
              <input type="radio"
                     name="brandSelection"
                     value="Eaton"
                     aria-label="Eaton"
                     data-logo-url="https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Eaton.png?v=1769090184">
              <img src="https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Eaton.png?v=1769090184" alt="Eaton Logo" class="brand-radio-image" loading="lazy">
            </label>
          </div>
        </div>
        <div class="brand-info-tooltip-container">
          <i class="fas fa-info-circle brand-info-icon" id="brand-info-icon" aria-label="Info"></i>
          <div class="brand-info-tooltip" id="brand-info-tooltip">
            Die Wahl der Marke wirkt sich ausschließlich auf den Hauptschalter, den FI-Schalter und die Leitungsschutzschalter aus.
          </div>
        </div>
      </div>

      <div id="configurator">

        <input type="text" id="verteilerName" placeholder="Verteiler-Name/Referenz eingeben" class="verteiler-input">
          
          <!-- Produktkarten-Grid (sichtbar direkt nach Markenauswahl) -->
          <div class="produktkarten-grid">
            <!-- Unterzähler -->
            <div class="produktkarte">  
              <img src="https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Unterzaehler_99c6ffde-7041-40e7-b11f-c31a5cb1e77d.png?v=1756321308" alt="Unterzähler" class="produktbild" loading="lazy" decoding="async">
              <div class="produktname">Unterzähler</div>
              <div class="produktpreis"><span class="preis">72,80&nbsp;€</span></div>
              <div class="produktbuttons">
                <button id="uez-mit-btn" class="mit-btn" type="button" onclick="toggleUnterzaehler(true)">mit</button>
                <button id="uez-ohne-btn"class="ohne-btn active" type="button" onclick="toggleUnterzaehler(false)">ohne</button> 
              </div>
            </div>
            <!-- Überspannungsschutz -->
            <div class="produktkarte" data-einheiten="4">
              <img src="https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Ueberspannungsschutz_b02f7f9b-e3f6-4e26-ac1a-96ce9e681993.png?v=1756321309" alt="Überspannungsschutz" class="produktbild" loading="lazy" decoding="async">
              <div class="produktname">Überspannungsschutz</div>
              <div class="produktpreis"><span class="preis">89,90&nbsp;€</span></div>
              <div class="produktbuttons">
                <button id="ues-mit-btn" class="mit-btn" type="button" onclick="toggleUeberspannungsschutz(true)">mit</button>
                <button id="ues-ohne-btn" class="ohne-btn active" type="button" onclick="toggleUeberspannungsschutz(false)">ohne</button>
              </div>
            </div>
            <!-- Hauptschalter -->
            <div class="produktkarte">
              <img src="https://cdn.shopify.com/s/files/1/0944/8711/8089/files/Hauptschalter_9db5d20e-8e22-4fb8-9f83-4b1909e10c77.png?v=1756321561" alt="Hauptschalter" class="produktbild" loading="lazy" decoding="async">
              <div class="produktname">Hauptschalter</div>
              <div class="produktpreis"><span class="preis">14,11&nbsp;€</span></div>
              <div class="produktbuttons">
                <button id="hs-mit-btn" class="mit-btn" type="button" onclick="toggleHauptschalter(true)">mit</button>
                <button id="hs-ohne-btn" class="ohne-btn active" type="button" onclick="toggleHauptschalter(false)">ohne</button>
              </div>
            </div>
          </div>
          
        <div id="row1-strip" class="row-strip">
          <div id="buttonsRow1" class="buttons-container-top"></div>
        </div>
        <div id="row1" class="row-container">
          <div id="row1Content" class="row-content"></div>
        </div>
        <div class="button-row">
          <button id="addFiRowButton" class="button button--outline" type="button">
            <i class="fas fa-plus"></i> FI-Bereich hinzufügen
          </button>
          <button id="addFreeRowButton" class="button button--outline" type="button">
            <i class="fas fa-plus"></i> Freien Bereich ohne Sammel-FI hinzufügen
          </button>
        </div>
      </div>
      
      <!-- Sonstige Hinweise Textfeld -->
      <div class="sonstige-hinweise-container">
        <label for="sonstigeHinweise" class="sonstige-hinweise-label">Sonstige Hinweise</label>
        <textarea 
          id="sonstigeHinweise" 
          name="sonstigeHinweise" 
          class="sonstige-hinweise-textarea" 
          maxlength="300" 
          placeholder="Optional: Nur Hinweise zur allgemeinen Verdrahtung. Zusatzprodukte werden ohne Absprache nicht berücksichtigt (max. 300 Zeichen)"
        ></textarea>
        <div class="sonstige-hinweise-counter">
          <span id="sonstigeHinweiseCounter">0</span> / 300 Zeichen
        </div>
      </div>
    </div>

    <!-- Weitere Seiten -->
    

    <div id="page2" class="page">
        <div style="text-align: center; margin: 20px 0;">
          <div style="max-width: 1200px; margin: 20px auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h2 style="margin-top: 0;">Verteilerkasten</h2>
            <p class="montageart-subtitle" style="font-size: 15px; color: #64748b; margin: 10px 0 22px; line-height: 1.45;">Wählen Sie die Montageart des Verteilers. Dies beeinflusst Bauform und Preis.</p>
          <div style="margin-bottom: 30px;">
            <div class="montageart-cards-container">
              <!-- Card 1: Kein Verteilerkasten benötigt -->
              <div class="montageart-card" data-montageart="Kein Verteilerkasten benötigt" style="position: relative; flex: 1; min-width: 280px; max-width: 320px; background: #fff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s ease;">
                <input type="radio" name="montageart-option" value="Kein Verteilerkasten benötigt" class="montageart-radio" style="position: absolute; top: 16px; right: 16px; width: 20px; height: 20px; cursor: pointer;">
                <div style="text-align: left;">
                  <h3 style="font-size: 1.6rem; font-weight: 600; color: #111827; margin: 0 0 12px;">Kein Verteilerkasten benötigt</h3>
                  <p style="font-size: 1.4rem; color: #6b7280; line-height: 1.5; margin: 0 0 20px;">Ich benötige keinen Verteilerkasten<br>(z. B. bereits vorhanden oder nur Komponentenbestellung).</p>
                  <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                    <div class="montageart-price" data-montageart="Kein Verteilerkasten benötigt" style="font-size: 1.6rem; font-weight: 600; color: #005A9C;">0,00 €</div>
                  </div>
                </div>
              </div>

              <!-- Card 2: Aufputz-Montage -->
              <div class="montageart-card" data-montageart="Aufputz-Montage" style="position: relative; flex: 1; min-width: 280px; max-width: 320px; background: #fff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s ease;">
                <input type="radio" name="montageart-option" value="Aufputz-Montage" class="montageart-radio" checked style="position: absolute; top: 16px; right: 16px; width: 20px; height: 20px; cursor: pointer; accent-color: #005A9C;">
                <div style="text-align: left;">
                  <h3 style="font-size: 1.6rem; font-weight: 600; color: #111827; margin: 0 0 12px;">Aufputz-Montage</h3>
                  <p style="font-size: 1.4rem; color: #6b7280; line-height: 1.5; margin: 0 0 20px;">Klassische Montage auf der Wand. Ideal bei sichtbarer Installation.</p>
                  <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                    <div class="montageart-price" data-montageart="Aufputz-Montage" style="font-size: 1.6rem; font-weight: 600; color: #005A9C;">+49,44 €</div>
                  </div>
                </div>
              </div>
              
              <!-- Card 3: Aufputz (Feuchtraum)-Montage -->
              <div class="montageart-card" data-montageart="Aufputz(Feuchtraum)-Montage" style="position: relative; flex: 1; min-width: 280px; max-width: 320px; background: #fff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s ease;">
                <input type="radio" name="montageart-option" value="Aufputz(Feuchtraum)-Montage" class="montageart-radio" style="position: absolute; top: 16px; right: 16px; width: 20px; height: 20px; cursor: pointer;">
                <div style="text-align: left;">
                  <h3 style="font-size: 1.6rem; font-weight: 600; color: #111827; margin: 0 0 12px;">Aufputz (Feuchtraum)-<br>Montage</h3>
                  <p style="font-size: 1.4rem; color: #6b7280; line-height: 1.5; margin: 0 0 20px;">Für Keller, Waschküche oder andere feuchte Umgebungen geeignet.</p>
                  <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                    <div class="montageart-price" data-montageart="Aufputz(Feuchtraum)-Montage" style="font-size: 1.6rem; font-weight: 600; color: #005A9C;">+60,07 €</div>
                  </div>
                </div>
              </div>
              
              <!-- Card 4: Unterputz-Montage -->
              <div class="montageart-card" data-montageart="Unterputz-Montage" style="position: relative; flex: 1; min-width: 280px; max-width: 320px; background: #fff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s ease;">
                <input type="radio" name="montageart-option" value="Unterputz-Montage" class="montageart-radio" style="position: absolute; top: 16px; right: 16px; width: 20px; height: 20px; cursor: pointer;">
                <div style="text-align: left;">
                  <h3 style="font-size: 1.6rem; font-weight: 600; color: #111827; margin: 0 0 12px;">Unterputz-Montage</h3>
                  <p style="font-size: 1.4rem; color: #6b7280; line-height: 1.5; margin: 0 0 20px;">Bündig in der Wand. Sauberes Erscheinungsbild, häufige Standardwahl.</p>
                  <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                    <div class="montageart-price" data-montageart="Unterputz-Montage" style="font-size: 1.6rem; font-weight: 600; color: #005A9C;">+61,83 €</div>
                  </div>
                </div>
              </div>
              
              <!-- Card 5: Hohlwand-Montage -->
              <div class="montageart-card" data-montageart="Hohlwand-Montage" style="position: relative; flex: 1; min-width: 280px; max-width: 320px; background: #fff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s ease;">
                <input type="radio" name="montageart-option" value="Hohlwand-Montage" class="montageart-radio" style="position: absolute; top: 16px; right: 16px; width: 20px; height: 20px; cursor: pointer;">
                <div style="text-align: left;">
                  <h3 style="font-size: 1.6rem; font-weight: 600; color: #111827; margin: 0 0 12px;">Hohlwand-Montage</h3>
                  <p style="font-size: 1.4rem; color: #6b7280; line-height: 1.5; margin: 0 0 20px;">Für Trockenbauwände (z. B. Rigips). Stabiler Sitz in Hohlwänden.</p>
                  <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                    <div class="montageart-price" data-montageart="Hohlwand-Montage" style="font-size: 1.6rem; font-weight: 600; color: #005A9C;">+69,46 €</div>
                  </div>
                </div>
              </div>
              
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="page3" class="page">
        <div style="text-align: center; margin: 20px 0;">
          <div style="max-width: 1200px; margin: 20px auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h2 style="margin-top: 0;">Verdrahtung</h2>
            <p class="verdrahtung-subtitle" style="font-size: 15px; color: #64748b; margin: 10px 0 22px; line-height: 1.45;">Wählen Sie, ob Ihr Sicherungskasten vormontiert und verdrahtet geliefert werden soll.</p>
          <div style="margin-bottom: 30px;">
            <div class="verdrahtung-cards-container" style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
              <!-- Card 1: Selbstverdrahtung -->
              <div class="verdrahtung-card" data-verdrahtung="Nur Einzelteile (ohne Verdrahtung & Zubehör)" style="position: relative; flex: 1; min-width: 280px; max-width: 320px; background: #fff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s ease;">
                <input type="radio" name="verdrahtung-option" value="Nur Einzelteile (ohne Verdrahtung & Zubehör)" class="verdrahtung-radio" style="position: absolute; top: 16px; right: 16px; width: 20px; height: 20px; cursor: pointer;">
                <div style="text-align: left;">
                  <h3 style="font-size: 1.6rem; font-weight: 600; color: #111827; margin: 0 0 12px;">Selbstverdrahtung</h3>
                  <p style="font-size: 1.4rem; color: #6b7280; line-height: 1.5; margin: 0 0 20px;">Lieferung einzelner Komponenten ohne Verdrahungsmaterial.</p>
                  <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                    <div class="verdrahtung-price" data-verdrahtung="Nur Einzelteile (ohne Verdrahtung & Zubehör)" style="font-size: 1.6rem; font-weight: 600; color: #005A9C;">0,00 €</div>
                    <div style="font-size: 1.3rem; color: #6b7280;">Keine Vormontage</div>
                  </div>
                </div>
              </div>
              
              <!-- Card 2: Zubehör-Set für Verdrahtung -->
              <div class="verdrahtung-card" data-verdrahtung="Verdrahtungszubehör (ohne Vormontage & Verdrahtung)" style="position: relative; flex: 1; min-width: 280px; max-width: 320px; background: #fff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s ease;">
                <input type="radio" name="verdrahtung-option" value="Verdrahtungszubehör (ohne Vormontage & Verdrahtung)" class="verdrahtung-radio" style="position: absolute; top: 16px; right: 16px; width: 20px; height: 20px; cursor: pointer;">
                <div style="text-align: left;">
                  <h3 style="font-size: 1.6rem; font-weight: 600; color: #111827; margin: 0 0 12px;">Zubehör-Set für Verdrahtung</h3>
                  <p style="font-size: 1.4rem; color: #6b7280; line-height: 1.5; margin: 0 0 20px;">Verdrahtungsleitungen (farbig) inkl. Aderendhülsen und Verdrahtungszubehör.</p>
                  <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                    <div class="verdrahtung-price" data-verdrahtung="Verdrahtungszubehör (ohne Vormontage & Verdrahtung)" style="font-size: 1.6rem; font-weight: 600; color: #005A9C;">+15,00 €</div>
                    <div style="font-size: 1.3rem; color: #6b7280;">Material inkl.</div>
                  </div>
                </div>
              </div>
              
              <!-- Card 3: Vormontiert & verdrahtet (Empfohlen) -->
              <div class="verdrahtung-card verdrahtung-card--recommended" data-verdrahtung="Vormontage & Verdrahtung" style="position: relative; flex: 1; min-width: 280px; max-width: 320px; background: #fff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s ease;">
                <span class="verdrahtung-recommended-badge" style="position: absolute; top: -10px; left: 16px; background: #005A9C; color: #fff; padding: 4px 12px; border-radius: 12px; font-size: 1.2rem; font-weight: 600;">Empfohlen</span>
                <input type="radio" name="verdrahtung-option" value="Vormontage & Verdrahtung" class="verdrahtung-radio" checked style="position: absolute; top: 16px; right: 16px; width: 20px; height: 20px; cursor: pointer; accent-color: #005A9C;">
                <div style="text-align: left;">
                  <h3 style="font-size: 1.6rem; font-weight: 600; color: #111827; margin: 0 0 12px;">Vormontiert & verdrahtet</h3>
                  <p style="font-size: 1.4rem; color: #6b7280; line-height: 1.5; margin: 0 0 20px;">Anschlussfertig geliefert. Spart Zeit & vermeidet Fehler.</p>
                  <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                    <div class="verdrahtung-price" data-verdrahtung="Vormontage & Verdrahtung" style="font-size: 1.6rem; font-weight: 600; color: #005A9C;">+20,00 €</div>
                    <div style="font-size: 1.3rem; color: #6b7280;">Anschlussfertig</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="page4" class="page">
      <div class="summary-header">
        <h2 class="summary-header__title">Zusammenfassung</h2>
        <p class="summary-header__subtitle">Prüfe deine Angaben – du kannst einzelne Bereiche jederzeit bearbeiten.</p>
      </div>
      <div class="summary-layout">
        <!-- Linke Spalte: Konfigurationsdetails und Elemente -->
        <div class="summary-left">
          <!-- Konfigurationsdetails Card -->
          <div class="kd-card">
            <div class="kd-header">
              <h2 class="kd-title">Konfigurationsdetails</h2>
            </div>
            <div class="kd-content">
              <div class="kd-row">
                <div class="kd-key">Name/Referenz</div>
                <div class="kd-val"><span id="summaryVerteilerName">Nicht angegeben</span></div>
              </div>
              <div class="kd-row">
                <div class="kd-key">Position im Verteiler</div>
                <div class="kd-val"><span id="summaryPosition">Oben</span></div>
              </div>
              <div class="kd-row">
                <div class="kd-key">Anzahl der Reihen</div>
                <div class="kd-val"><span id="summaryRowCount">1</span></div>
              </div>
              <div class="kd-row">
                <div class="kd-key">Belegte Einheiten</div>
                <div class="kd-val"><span id="summaryUsedUnits">0</span></div>
              </div>
              <div class="kd-row">
                <div class="kd-key">Montageart</div>
                <div class="kd-val"><span id="summaryMontageart">Nicht ausgewählt</span></div>
              </div>
              <div class="kd-row">
                <div class="kd-key">Verdrahtungsoption</div>
                <div class="kd-val"><span id="summaryVerdrahtung">Nicht ausgewählt</span></div>
              </div>
              <div class="kd-row">
                <div class="kd-key">Marke</div>
                <div class="kd-val"><span id="summaryMarke">Gewiss</span></div>
              </div>
              <div class="kd-row">
                <div class="kd-key">Sonstige Hinweise</div>
                <div class="kd-val kd-val--normal"><span id="summarySonstigeHinweise">—</span></div>
              </div>
            </div>
          </div>

          <!-- Verwendete Elemente Card -->
          <div class="kd-card">
            <div class="kd-header">
              <div>
                <h2 class="kd-title">Verwendete Elemente</h2>
              </div>
              <button id="downloadPdf" class="kd-downloadBtn" type="button">
                <i class="fas fa-download" aria-hidden="true"></i>
                <span>Konfiguration herunterladen</span>
              </button>
            </div>
            <div class="kd-content">
              <div id="summaryElements"></div>
            </div>
          </div>
        </div>

        <!-- Rechte Spalte: Preis Card -->
        <div class="summary-right price-sticky">
          <div class="price-card">
            <div class="price-card__header">
              <div class="price-card__headerRow">
                <div>
                  <div class="price-card__title">Gesamtpreis</div>
                  <div class="price-card__subtitle">inkl. MwSt.</div>
                </div>
                <div class="price-card__priceBox">
                  <div class="price-card__price"><span id="summaryTotalPrice" aria-live="polite">0 €</span></div>
                </div>
              </div>
            </div>
            <div class="price-card__content">
              <div class="price-trust">
                <div class="price-trust__item">
                  <i class="fas fa-check-circle price-trust__icon" aria-hidden="true"></i>
                  <span>Kostenloser Versand</span>
                </div>
                <div class="price-trust__item">
                  <i class="fas fa-check-circle price-trust__icon" aria-hidden="true"></i>
                  <span>Lieferung in 2–5 Werktagen</span>
                </div>
                <div class="price-trust__item">
                  <i class="fas fa-check-circle price-trust__icon" aria-hidden="true"></i>
                  <span>Fachmännisch geprüft</span>
                </div>
              </div>
              <div class="price-sep"></div>
              <div class="qty-row">
                <div>
                  <div class="qty-row__label" id="labelAnzahl">Anzahl</div>
                  <div class="qty-row__hint">Gleiche Konfiguration</div>
                </div>
                <quantity-input class="quantity cart-quantity">
                  <button class="quantity__button" name="minus" type="button">
                    <span class="visually-hidden">Menge verringern</span>
                    <span class="svg-wrapper">
                      {{- 'icon-minus.svg' | inline_asset_content -}}
                    </span>
                  </button>
                  <input
                    class="quantity__input"
                    type="number"
                    id="verteilerAnzahl"
                    aria-labelledby="labelAnzahl"
                    min="1"
                    max="10"
                    step="1"
                    value="1"
                    onchange="updateGesamtpreis()"
                  >
                  <button class="quantity__button" name="plus" type="button">
                    <span class="visually-hidden">Menge erhöhen</span>
                    <span class="svg-wrapper">
                      {{- 'icon-plus.svg' | inline_asset_content -}}
                    </span>
                  </button>
                </quantity-input>
              </div>
              <button id="addToCartButton" class="price-cta" type="button" style="display: none;">
                <i class="fas fa-shopping-cart" aria-hidden="true"></i>
                <span>In den Warenkorb legen</span>
              </button>
            </div>
          </div>
          
          <!-- Hinweise Container -->
          <div class="price-details">
            <div class="price-details__content">
              <div class="price-details__row">
                <div class="price-details__icon">
                  <i class="fas fa-info-circle" aria-hidden="true"></i>
                </div>
                <div>
                  <div class="price-details__title">Inklusive</div>
                  <div class="price-details__desc">Diese Konfiguration enthält folgende Standardkomponenten:</div>
                  <div class="price-details__tags">
                    <span class="price-details__tag" id="tagNPEKlemme">N und PE Klemme</span>
                    <span class="price-details__tag" id="tagPhasenschiene" style="display: none;">Phasenschiene</span>
                    <span class="price-details__tag" id="tagBeruehrungsschutz" style="display: none;">Berührungsschutz</span>
                    <span class="price-details__tag" id="tagBlindabdeckstreifen" style="display: none;">Blindabdeckstreifen</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Button-Container für Weiter und Zurück -->
    <div class="button-container" style="display: flex; justify-content: space-between; width: 1200px; margin: 20px auto;">
      <button id="prevButton" class="button" type="button">Zurück</button>
      <button id="nextButton" class="button button--outline" type="button" disabled>Weiter</button>
    </div>
    </main>
    <div class="konfigurator-bottom-gap"></div>
  </div>
 
  <!-- Konfigurator JavaScript -->
  <script src="{{ 'quantity-popover.js' | asset_url }}" defer></script>
  <script src="{{ 'page-konfigurator.js' | asset_url }}" defer></script>
  <!-- Konfigurator Produktdaten -->
  <script id="konfigurator-products" type="application/json">
{%- if collections.konfigurator.products.size > 0 -%}
[
  {%- for product in collections.konfigurator.products -%}
    {
      "id": {{ product.id }},
      "title": {{ product.title | json }},
      "variants": [
        {%- for variant in product.variants -%}
          {
            "id": {{ variant.id }},
            "title": {{ variant.title | json }},
            "price": {{ variant.price | divided_by: 100.0 }},
            "sku": {{ variant.sku | json }},
            "image": {{ variant.featured_image | img_url: '400x' | json }},
            "metafields": {
              "custom": {
                "hohe": {% if variant.metafields.custom.hohe %}{{ variant.metafields.custom.hohe | metafield_text | json }}{% else %}null{% endif %},
                "breite": {% if variant.metafields.custom.breite %}{{ variant.metafields.custom.breite | metafield_text | json }}{% else %}null{% endif %},
                "tiefe": {% if variant.metafields.custom.tiefe %}{{ variant.metafields.custom.tiefe | metafield_text | json }}{% else %}null{% endif %}
              }
            }
          }{%- unless forloop.last -%},{%- endunless -%}
        {%- endfor -%}
      ]
    }{%- unless forloop.last -%},{%- endunless -%}
  {%- endfor -%}
]
{%- else -%}
[]
{%- endif -%}
</script>
<script>
  // Funktion zum Laden der Bilder
  function handleImageLoad(img) {
    img.classList.add('loaded');
    img.parentElement.classList.add('loaded');
  }

  // Event-Listener für alle Bilder
  document.addEventListener('DOMContentLoaded', function() {
    const images = document.querySelectorAll('.product-box img');
    images.forEach(img => {
      if (img.complete) {
        handleImageLoad(img);
      } else {
        img.addEventListener('load', function() {
          handleImageLoad(this);
        });
      }
    });
  });
</script>
</div>

<!-- Modal-Overlay und -Dialog für schöne Alerts -->
<div id="cb-backdrop" class="cb-backdrop" hidden></div>
<div id="cb-modal" class="cb-modal" role="alertdialog" aria-modal="true"
     aria-labelledby="cb-modal-title" aria-describedby="cb-modal-desc" hidden>
  <div class="cb-modal__card" tabindex="-1">
    <div class="cb-modal__icon" aria-hidden="true">
      <svg viewBox="0 0 24 24"><path d="M1 21h22L12 2 1 21zm12-3h-2v2h2v-2zm0-8h-2v6h2V10z"/></svg>
    </div>
    <h2 id="cb-modal-title" class="cb-modal__title">Hinweis</h2>
    <p id="cb-modal-desc" class="cb-modal__text"></p>
    <div class="cb-modal__actions">
      <button type="button" class="cb-btn cb-btn--primary" id="cb-modal-ok">OK</button>
    </div>
  </div>
</div>


<script>
(function(){
  const $modal = document.getElementById('cb-modal');
  const $backdrop = document.getElementById('cb-backdrop');
  const $ok = document.getElementById('cb-modal-ok');
  const $title = document.getElementById('cb-modal-title');
  const $desc = document.getElementById('cb-modal-desc');
  let lastActive = null;
  let prevOverflow = '';

  function closeAllDropdowns(){
    // Portal-Dropdown
    const portal = document.getElementById('portal-dropdown');
    if (portal) portal.style.display = 'none';
    // Reihen-Dropdowns (Element hinzufügen)
    const dds = document.querySelectorAll('.dropdown');
    dds.forEach(dd => {
      dd.style.display = 'none';
      dd.setAttribute('aria-hidden', 'true');
      const btn = dd.previousElementSibling;
      if (btn && btn.classList && btn.classList.contains('dropdown-btn')) {
        btn.setAttribute('aria-expanded', 'false');
      }
    });
  }

  function trapFocus(e){
    if(!$modal.hasAttribute('open')) return;
    const f = $modal.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])');
    if(!f.length) return;
    const first=f[0], last=f[f.length-1];
    if(e.key==='Tab'){
      if(e.shiftKey && document.activeElement===first){ e.preventDefault(); last.focus(); }
      else if(!e.shiftKey && document.activeElement===last){ e.preventDefault(); first.focus(); }
    }
    if(e.key==='Escape'){ close(); }
  }
  function open({title, message}){
    lastActive = document.activeElement;
    $title.textContent = title || 'Hinweis';
    $desc.textContent  = message || '';
    // Scroll sperren & Dropdowns schließen
    prevOverflow = document.body.style.overflow;
    document.body.style.overflow = 'hidden';
    closeAllDropdowns();
    $modal.hidden=false; $backdrop.hidden=false;
    requestAnimationFrame(()=>{ $modal.setAttribute('open',''); $backdrop.setAttribute('open',''); $ok.focus(); });
    document.addEventListener('keydown', trapFocus);
    return new Promise(res=>{ $ok.onclick = ()=>{ close(); res(true); }; $backdrop.onclick = ()=>{ close(); res(true); }; });
  }
  function close(){
    $modal.removeAttribute('open'); $backdrop.removeAttribute('open');
    setTimeout(()=>{ $modal.hidden=true; $backdrop.hidden=true; lastActive && lastActive.focus(); },180);
    document.removeEventListener('keydown', trapFocus);
    // Scroll wieder erlauben
    document.body.style.overflow = prevOverflow || '';
  }
  window.cbAlert = open;

  // Optional: native alert auf cbAlert umbiegen
  const nativeAlert = window.alert.bind(window);
  window.alert = function(msg){
    const str = String(msg||'');
    const t = str.split(/[.!?\n]/)[0].slice(0,80) || 'Hinweis';
    try { return open({ title: t, message: str }); }
    catch(e){ return nativeAlert(str); }
  };
})();
</script>

</body>
</html>


{% schema %}
{
  "name": "Konfigurator Section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Titel",
      "default": "Konfigurator"
    },
    {
      "type": "select",
      "id": "default_marke",
      "label": "Standard-Marke der Komponenten",
      "options": [
        {
          "value": "Hager",
          "label": "Hager"
        },
        {
          "value": "Gewiss",
          "label": "Gewiss"
        }
      ],
      "default": "Hager",
      "info": "Wählen Sie die Standard-Marke für FI-Schalter und Leitungsschutzschalter"
    },
    { "type": "range", "id": "padding_top", "min": 0, "max": 200, "step": 4, "unit": "px", "label": "Padding oben (mobil)", "default": 24 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 200, "step": 4, "unit": "px", "label": "Padding unten (mobil)", "default": 24 },
    { "type": "range", "id": "padding_top_desktop", "min": 0, "max": 240, "step": 4, "unit": "px", "label": "Padding oben (Desktop)", "default": 48 },
    { "type": "range", "id": "padding_bottom_desktop", "min": 0, "max": 240, "step": 4, "unit": "px", "label": "Padding unten (Desktop)", "default": 48 }
  ],
  "presets": [
    {
      "name": "Konfigurator-Block"
    }
  ]
}
{% endschema %}

