{% comment %}
  Collections Grid Section
  - 2 cols on mobile, 4 cols on xl
  - Each tile: optional image (object-contain), title bottom-left, link wraps tile
  - Optional captions below grid

  How to use:
  1) Save as: sections/collections-grid.liquid
  2) Add section on any page/template and add up to 12 tiles.
{% endcomment %}

<section id="section-{{ section.id }}" class="collections-grid">
  <div class="container">
    {% if section.settings.heading != blank %}
      <h2 class="heading">{{ section.settings.heading }}</h2>
    {% endif %}
    {% if section.settings.subtitle != blank and section.settings.subtitle != '' %}
      <p class="subtitle">{{ section.settings.subtitle | strip }}</p>
    {% endif %}

    <div class="grid">
      {% for block in section.blocks %}
        {% assign link = block.settings.link | default: '#' %}
        <a
          {{ block.shopify_attributes }}
          href="{{ link }}"
          class="tile tile--bg-{{ block.settings.bg_style }}"
          aria-label="{{ block.settings.title | escape }}"
        >
          <div class="tile__inner">
            {% if block.settings.image != blank %}
              <div class="tile__media">
                <img
                  src="{{ block.settings.image | image_url: width: 1200 }}"
                  srcset="
                    {{ block.settings.image | image_url: width: 600 }} 600w,
                    {{ block.settings.image | image_url: width: 900 }} 900w,
                    {{ block.settings.image | image_url: width: 1200 }} 1200w
                  "
                  sizes="(min-width: 1280px) 25vw, (min-width: 768px) 50vw, 100vw"
                  alt="{{ block.settings.image.alt | default: block.settings.title | escape }}"
                  loading="lazy"
                />
              </div>
            {% endif %}

            <div class="tile__label">
              <div class="tile__label-content">
                <span class="tile__title">{{ block.settings.title }}</span>
                {% if block.settings.subtitle != blank and block.settings.subtitle != '' %}
                  <span class="tile__subtitle">{{ block.settings.subtitle | strip }}</span>
                {% endif %}
              </div>
              <span class="tile__arrow" aria-hidden>→</span>
            </div>
          </div>
        </a>
      {% else %}
        <div class="empty">
          <p>Add tiles in the section settings.</p>
        </div>
      {% endfor %}
    </div>

  </div>

  {% style %}
    #section-{{ section.id }} { 
      background: #f8fafc; 
      color: #0f172a; 
      padding-top: {{ section.settings.padding_top | default: 40 }}px;
      padding-bottom: {{ section.settings.padding_bottom | default: 40 }}px;
    }
    {% assign alignment = section.settings.text_alignment | default: 'left' %}
    #section-{{ section.id }} .container { 
      max-width: 1400px; 
      margin: 0 auto; 
      padding: 0 clamp(1rem, 4vw, 50px); 
    }
    #section-{{ section.id }} .heading { 
      font-size: 32px; 
      font-weight: 800; 
      margin: 0 0 0.5rem; 
      text-align: {{ alignment }};
    }
    #section-{{ section.id }} .subtitle { 
      font-size: 18px; 
      font-weight: 400; 
      margin: 0 0 1.5rem; 
      color: #64748b;
      text-align: {{ alignment }};
    }
    #section-{{ section.id }} .subtitle:empty { 
      display: none; 
    }

    /* Grid: 1 col on mobile, 2 cols on tablet, 4 on xl */
    #section-{{ section.id }} .grid { 
      display: grid; 
      grid-template-columns: 1fr; 
      gap: 1.5rem;
      width: 100%;
      {% if alignment == 'center' %}
        margin-left: auto;
        margin-right: auto;
      {% elsif alignment == 'right' %}
        margin-left: auto;
        margin-right: 0;
      {% else %}
        margin-left: 0;
        margin-right: auto;
      {% endif %}
    }
    @media (min-width: 768px) { 
      #section-{{ section.id }} .grid { 
        grid-template-columns: repeat(2, 1fr); 
        gap: 2rem; 
        {% if alignment != 'left' %}
          max-width: fit-content;
        {% endif %}
      } 
    }
    @media (min-width: 1280px){ 
      #section-{{ section.id }} .grid { 
        grid-template-columns: repeat(4, 1fr); 
        gap: 2rem; 
        {% if alignment != 'left' %}
          max-width: fit-content;
        {% endif %}
      } 
    }

    /* Tile */
    #section-{{ section.id }} .tile { display: block; border-radius: 1.5rem; overflow: hidden; border: 1px solid #e2e8f0; box-shadow: 0 1px 2px rgba(2,6,23,.04); text-decoration: none; color: inherit; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    #section-{{ section.id }} .tile:hover { transform: translateY(-4px); box-shadow: 0 8px 25px rgba(2,6,23,.12); }
    #section-{{ section.id }} .tile--bg-light { background: #f1f5f9; }
    #section-{{ section.id }} .tile--bg-white { background: #fff; }

    #section-{{ section.id }} .tile__inner { 
      position: relative; 
      padding: clamp(1rem, 3vw, 2rem); 
      aspect-ratio: 4 / 5; 
      display: block; 
      min-height: 400px; 
    }
    @media (max-width: 767px) {
      #section-{{ section.id }} .tile__inner { 
        min-height: 300px; 
        padding: 1rem;
      }
    }
    #section-{{ section.id }} .tile__media { 
      position: absolute; 
      top: clamp(0.5rem, 2vw, 1rem); 
      left: clamp(0.5rem, 2vw, 1rem); 
      right: clamp(0.5rem, 2vw, 1rem); 
      bottom: 70px; 
      display: grid; 
      place-items: center; 
      padding: clamp(0.5rem, 1.5vw, 1.5rem); 
    }
    @media (max-width: 767px) {
      #section-{{ section.id }} .tile__media { 
        bottom: 80px; 
        padding: 0.5rem;
      }
    }
    #section-{{ section.id }} .tile__media img { max-width: 100%; max-height: 100%; width: 100%; height: 100%; object-fit: contain; object-position: center; transition: transform 0.3s ease, filter 0.3s ease; }
    
    /* Bilder sollen vollständig sichtbar sein */
    #section-{{ section.id }} .tile__media { overflow: visible; }
    #section-{{ section.id }} .tile:hover .tile__media img { transform: scale(1.05); filter: brightness(1.1); }

    #section-{{ section.id }} .tile__label { 
      position: absolute; 
      bottom: clamp(1rem, 3vw, 2rem); 
      left: clamp(1rem, 3vw, 2rem); 
      right: clamp(1rem, 3vw, 2rem); 
      display: flex; 
      align-items: center; 
      justify-content: space-between;
      gap: .5rem; 
    }
    @media (max-width: 767px) {
      #section-{{ section.id }} .tile__label { 
        bottom: 1rem; 
        left: 1rem; 
        right: 1rem; 
      }
    }
    #section-{{ section.id }} .tile__label-content {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      flex: 1;
    }
    #section-{{ section.id }} .tile__title { 
      font-size: 16px; 
      font-weight: 600; 
      color: #1f2937; 
      line-height: 1.2;
    }
    #section-{{ section.id }} .tile__subtitle { 
      font-size: 14px; 
      font-weight: 400; 
      color: #637381; 
      line-height: 1.3;
      display: block;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    #section-{{ section.id }} .tile__subtitle:empty { 
      display: none; 
    }
    #section-{{ section.id }} .tile:hover .tile__label .tile__arrow { transform: translateX(2px); }
    #section-{{ section.id }} .tile__arrow { 
      transition: transform .15s ease; 
      font-size: 16px;
      flex-shrink: 0;
    }


    /* Empty state */
    #section-{{ section.id }} .empty { background: #fff; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 1.5rem; text-align: center; color: #475569; }
  {% endstyle %}
</section>

{% schema %}
{
  "name": "Collections Grid",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Collections" },
    { "type": "text", "id": "subtitle", "label": "Subtitel" },
    { "type": "select", "id": "text_alignment", "label": "Ausrichtung", "default": "left", "options": [
      { "value": "left", "label": "Links" },
      { "value": "center", "label": "Zentriert" },
      { "value": "right", "label": "Rechts" }
    ]},
    { "type": "range", "id": "padding_top", "min": 0, "max": 200, "step": 10, "unit": "px", "label": "Padding oben", "default": 40 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 200, "step": 10, "unit": "px", "label": "Padding unten", "default": 40 }
  ],
  "blocks": [
    {
      "type": "tile",
      "name": "Tile",
      "settings": [
        { "type": "text", "id": "title", "label": "Title", "default": "Konfigurator" },
        { "type": "text", "id": "subtitle", "label": "Subtitel" },
        { "type": "url",  "id": "link",  "label": "Link" },
        { "type": "image_picker", "id": "image", "label": "Image (optional)" },
        { "type": "select", "id": "bg_style", "label": "Tile background", "default": "light", "options": [
          { "value": "light", "label": "Light (slate-100)" },
          { "value": "white", "label": "White" }
        ]}
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "Collections Grid (4 tiles)",
      "blocks": [
        { "type": "tile", "settings": { "title": "Konfigurator", "bg_style": "light" } },
        { "type": "tile", "settings": { "title": "Startseite", "bg_style": "white" } },
        { "type": "tile", "settings": { "title": "PV / Speicher", "bg_style": "white" } },
        { "type": "tile", "settings": { "title": "E‑Mobilität", "bg_style": "light" } }
      ]
    }
  ]
}
{% endschema %}
